# Test Design: Story 1.4

Date: 2025-09-06
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 18
- Unit tests: 12 (67%)
- Integration tests: 5 (28%)
- E2E tests: 1 (5%)
- Priority distribution: P0: 10, P1: 6, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: Parser logic extracts key fields from typical forum posts

#### Scenarios

| ID           | Level | Priority | Test                                    | Justification                            |
| ------------ | ----- | -------- | --------------------------------------- | ---------------------------------------- |
| 1.4-UNIT-001 | Unit  | P0       | Tournament title extraction validation  | Pure pattern matching logic             |
| 1.4-UNIT-002 | Unit  | P0       | Rank range pattern matching             | Complex regex patterns with validation   |
| 1.4-UNIT-003 | Unit  | P1       | Tournament date extraction patterns     | Algorithm for various date formats       |
| 1.4-UNIT-004 | Unit  | P1       | Host name extraction from signatures    | Pattern recognition with multiple formats|
| 1.4-UNIT-005 | Unit  | P2       | Korean character processing validation  | UTF-8 processing algorithm correctness   |

### AC2: URL ID extraction for common URL types (Google Sheets, osu! forums, Google Forms, Challonge, YouTube, Twitch)

#### Scenarios

| ID           | Level | Priority | Test                                    | Justification                            |
| ------------ | ----- | -------- | --------------------------------------- | ---------------------------------------- |
| 1.4-UNIT-006 | Unit  | P0       | Google Sheets ID extraction             | Pure regex pattern matching            |
| 1.4-UNIT-007 | Unit  | P0       | Google Forms ID extraction              | Registration link validation algorithm   |
| 1.4-UNIT-008 | Unit  | P1       | osu! Forum link ID extraction           | Pattern matching for forum topic IDs    |
| 1.4-UNIT-009 | Unit  | P1       | Challonge tournament slug extraction    | Tournament bracket link validation       |
| 1.4-UNIT-010 | Unit  | P2       | YouTube/Twitch stream ID extraction     | Media platform ID parsing algorithms    |
| 1.4-UNIT-011 | Unit  | P0       | URL validation and security checks      | Security validation logic before extraction |

### AC3: NULL handling for missing fields

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                            |
| ------------ | ----------- | -------- | --------------------------------------- | ---------------------------------------- |
| 1.4-UNIT-012 | Unit        | P0       | Graceful extraction failure handling    | Error handling logic without dependencies |
| 1.4-INT-001  | Integration | P0       | Database NULL insertion validation      | Database interaction with NULL values    |

### AC4: Database storage with pending_review status

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                            |
| ------------ | ----------- | -------- | --------------------------------------- | ---------------------------------------- |
| 1.4-INT-002  | Integration | P0       | Tournament model parsing integration    | Service-to-model interaction with database |
| 1.4-INT-003  | Integration | P0       | Transaction handling and rollback       | Database transaction integrity           |
| 1.4-INT-004  | Integration | P1       | Status setting and validation           | Business rule enforcement in data layer  |

### Complete Workflow Scenarios

#### Scenarios

| ID           | Level       | Priority | Test                                    | Justification                            |
| ------------ | ----------- | -------- | --------------------------------------- | ---------------------------------------- |
| 1.4-E2E-001  | E2E         | P0       | Complete forum post parsing workflow    | Critical system workflow validation      |
| 1.4-INT-005  | Integration | P1       | Batch processing validation             | Component performance under load         |

## Risk Coverage

| Risk Area                    | Test Scenarios                          | Mitigation Strategy              |
| ---------------------------- | --------------------------------------- | -------------------------------- |
| Data Integrity              | 1.4-UNIT-001, 1.4-UNIT-012, 1.4-INT-001 | Validation + NULL handling      |
| Security (XSS Prevention)   | 1.4-UNIT-011                           | Input validation before processing |
| System Stability            | 1.4-UNIT-012, 1.4-INT-003              | Error handling + transaction rollback |
| Business Rule Compliance    | 1.4-UNIT-002, 1.4-INT-004              | Pattern validation + status management |
| External Integration        | 1.4-UNIT-006 through 1.4-UNIT-010      | URL validation for external services |
| Character Encoding Issues   | 1.4-UNIT-005                           | UTF-8 processing validation      |
| Database Constraints        | 1.4-INT-001, 1.4-INT-002, 1.4-INT-003  | Proper NULL handling + transactions |
| Performance/Scalability     | 1.4-INT-005                             | Batch processing validation      |

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 1.4-UNIT-001: Title extraction validation
   - 1.4-UNIT-002: Rank range pattern matching  
   - 1.4-UNIT-006: Google Sheets ID extraction
   - 1.4-UNIT-007: Google Forms ID extraction
   - 1.4-UNIT-011: URL validation and security checks
   - 1.4-UNIT-012: Graceful extraction failure handling

2. P0 Integration tests
   - 1.4-INT-001: Database NULL insertion validation
   - 1.4-INT-002: Tournament model parsing integration
   - 1.4-INT-003: Transaction handling and rollback

3. P0 E2E tests
   - 1.4-E2E-001: Complete forum post parsing workflow

4. P1 tests in order
   - 1.4-UNIT-003: Tournament date extraction patterns
   - 1.4-UNIT-004: Host name extraction from signatures
   - 1.4-UNIT-008: osu! Forum link ID extraction
   - 1.4-UNIT-009: Challonge tournament slug extraction
   - 1.4-INT-004: Status setting and validation
   - 1.4-INT-005: Batch processing validation

5. P2+ as time permits
   - 1.4-UNIT-005: Korean character processing validation
   - 1.4-UNIT-010: YouTube/Twitch stream ID extraction

## Test Implementation Notes

### Unit Test Files Required
- `tests/Unit/Services/ForumPostParserServiceTest.php` - Tests 1.4-UNIT-001 through 1.4-UNIT-005, 1.4-UNIT-012
- `tests/Unit/Utils/UrlExtractorTest.php` - Tests 1.4-UNIT-006 through 1.4-UNIT-011

### Integration Test Files Required
- `tests/Integration/Models/TournamentParsingTest.php` - Tests 1.4-INT-001 through 1.4-INT-004
- `tests/Integration/Parsing/BatchProcessingTest.php` - Test 1.4-INT-005

### E2E Test Files Required
- `tests/Feature/DataExtractionWorkflowTest.php` - Test 1.4-E2E-001

### Test Data Requirements
- Sample forum post content (English and Korean)
- Various URL formats for each supported service type
- Edge case content (malformed posts, special characters)
- Database fixtures for integration tests

### Quality Gates
- All P0 tests must pass before story completion
- P1 tests should pass with acceptable coverage
- Security validation tests (1.4-UNIT-011) are mandatory
- Database transaction tests (1.4-INT-003) are mandatory

## Coverage Validation Checklist

- [x] Every AC has at least one test
- [x] No duplicate coverage across levels
- [x] Critical paths have multiple levels (parsing has unit + integration + E2E)
- [x] Risk mitigations are addressed
- [x] Test IDs follow naming convention
- [x] Scenarios are atomic and independent
- [x] Security considerations included
- [x] Korean content handling covered
- [x] Error scenarios properly tested